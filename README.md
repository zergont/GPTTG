# GPTTGยโ Telegramโะฑะพั ะฝะฐยOpenAIยResponsesยAPIย๐ค๐ฎ

[![GitHubยโ GPTTG](https://img.shields.io/badge/GitHub-GPTTG-blue?logo=github)](https://github.com/zergont/GPTTG)
[![License:ยMIT](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

<!-- ะดะพะฑะฐะฒััะต ะฑะตะนะดะถ CI, ะตัะปะธ ะธัะฟะพะปัะทัะตัะต GitHubยActions -->

> **GPTTG**ยโ ะดะตะผะพะฝัััะฐัะธะพะฝะฝัะน Telegramโะฑะพั, ะฟะพะบะฐะทัะฒะฐััะธะน, ะบะฐะบยะธัะฟะพะปัะทะพะฒะฐัั **OpenAIยResponsesยAPI** ะฑะตะท ััะฐะฝะตะฝะธั ะฒัะตะน ะธััะพัะธะธ ัะฐัะฐ. ะะพะดะดะตัะถะธะฒะฐะตั ัะตะบัั, ะธะทะพะฑัะฐะถะตะฝะธั, ะณะพะปะพั (Whisper) ะธยะณะตะฝะตัะฐัะธั ะบะฐััะธะฝะพะบ.

---

## โจ ะะปััะตะฒัะต ะฒะพะทะผะพะถะฝะพััะธ

* **ResponsesยAPI ัย`previous_response_id`**ยโ ัะบะพะฝะพะผะธั ัะพะบะตะฝั, ะฝะตยะฝัะถะตะฝ ะฟะพะปะฝัะน ะปะพะณ ะดะธะฐะปะพะณะฐ
* **ะัะปััะธะผะพะดะฐะปัะฝะพััั:** ัะตะบััยโข ัะพัะพย+ ะฟะพะดะฟะธััยโข ะณะพะปะพัย(Whisper)ยโข `/img`ย(ะณะตะฝะตัะฐัะธั ัะตัะตะท DALLโE)
* ะฃััั ัะพะบะตะฝะพะฒ ะธยััะพะธะผะพััะธ ะฒ **SQLite**
* **ะะพะปะตะฒัะต ะบะปะฐะฒะธะฐัััั** (ะฟะพะปัะทะพะฒะฐัะตะปัโฏ/โฏะฐะดะผะธะฝ)
* ะัะธะฝััะพะฝะฝะพััั, ะฐะฒัะพะผะฐัะธัะตัะบะธะน backโoff, ัะฒะตะปะธัะตะฝะฝัะต ัะฐะนะผะฐััั
* ะะพัะฐะณะพะฒะฐั ะณะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน ัยะฒัะฑะพัะพะผ ะฒะตััะธะบะฐะปัะฝะพะณะพ ะธะปะธ ะณะพัะธะทะพะฝัะฐะปัะฝะพะณะพ ัะพัะผะฐัะฐ

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

1. [ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั](#ะฟัะตะดะฒะฐัะธัะตะปัะฝัะต-ััะตะฑะพะฒะฐะฝะธั)
2. [ะัััััะน ััะฐัั](#ะฑัััััะน-ััะฐัั)
3. [ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั](#ะฟะตัะตะผะตะฝะฝัะต-ะพะบััะถะตะฝะธั)
4. [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
5. [ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั](#ะฟัะธะผะตัั-ะธัะฟะพะปัะทะพะฒะฐะฝะธั)
6. [ResponsesยAPIยโ ะพัะพะฑะตะฝะฝะพััะธ](#responses-api-โ-ะพัะพะฑะตะฝะฝะพััะธ)
7. [ะะฐะฑะพัะฐ ัยัะฐะนะปะฐะผะธ](#ัะฐะฑะพัะฐ-ั-ัะฐะนะปะฐะผะธ)
8. [ะะธัะตะฝะทะธั](#ะปะธัะตะฝะทะธั)

---

## 1ยยทยะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

> ะัะพะฟัััะธัะต ััะพั ัะฐะณ, ะตัะปะธ **Pythonยโฅย3.9**, `pip` ะธย`poetry` ัะถะต ะฒย`$PATH`.

```bash
# ะฟัะพะฒะตัะธัั ะฒะตััะธะธ
python3 --version      # >= 3.9
python3 -m pip --version

# ัััะฐะฝะพะฒะธัั pip (ะตัะปะธ ะพััััััะฒัะตั)
python3 -m ensurepip --upgrade

# ัััะฐะฝะพะฒะธัั Poetry (ัะตะบะพะผะตะฝะดัะตะผัะน ะผะตะฝะตะดะถะตั ะทะฐะฒะธัะธะผะพััะตะน)
curl -sSL https://install.python-poetry.org | python3 -
exec "$SHELL"           # ะพะฑะฝะพะฒะธัะต PATH
poetry --version
```

---

## 2ยยทยะัััััะน ััะฐัั

### ะจะฐะณย1.ยะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน

```bash
git clone https://github.com/zergont/GPTTG.git
cd GPTTG
```

### ะจะฐะณย2.ยะะฐัััะพะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

```bash
cp .env.example .env
nano .env   # ะธะปะธ ะปัะฑะพะน ัะตะดะฐะบัะพั
```

ะะฐะฟะพะปะฝะธัะต ะพะฑัะทะฐัะตะปัะฝัะต ะฟะพะปัยโ `BOT_TOKEN`, `OPENAI_API_KEY`, `ADMIN_ID`.

### ะจะฐะณย3.ยะกะพะทะดะฐะนัะต ะพะบััะถะตะฝะธะต ะธยัััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ

<details>
<summary><strong>ะกะฟะพัะพะฑยAยโ Poetryย(ัะตะบะพะผะตะฝะดัะตััั)</strong></summary>

```bash
poetry install           # ัะพะทะดะฐัั .venv ะธยะฟะพััะฐะฒะธั ะทะฐะฒะธัะธะผะพััะธ
poetry run python -m bot.main   # ะทะฐะฟัััะธัั ะฑะพัะฐ ะฒัััะฝัั
```

</details>

<details>
<summary><strong>ะกะฟะพัะพะฑยBยโ venvย+ pip</strong></summary>

```bash
python3 -m venv .venv
source .venv/bin/activate      # Windows: .venv\Scripts\activate
pip install --upgrade pip
pip install -r requirements.txt

python3 -m bot.main             # ะทะฐะฟัััะธัั ะฑะพัะฐ ะฒัััะฝัั
```

</details>

### ะจะฐะณย4.ยะะฐะฟัััะธัะต ะฑะพัะฐ ะบะฐะบยsystemdโัะตัะฒะธัย(Productionโัะตะถะธะผ)

ะ ะบะพัะฝะต ะฟัะพะตะบัะฐ ัะถะต ะตััั ะณะพัะพะฒัะน ัะฐะนะป ัะตัะฒะธัะฐ `gpttg-bot.service`. ะะณะพ ะผะพะถะฝะพ ัะบะพะฟะธัะพะฒะฐัั ะฒ ะฝัะถะฝัะน ะบะฐัะฐะปะพะณ:

```bash
sudo cp gpttg-bot.service /etc/systemd/system/gpttg-bot.service
```

ะัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ ะพััะตะดะฐะบัะธััะนัะต ะฟะฐัะฐะผะตััั (ะฝะฐะฟัะธะผะตั, ะฟััะธ, ะฟะพะปัะทะพะฒะฐัะตะปั) ะฟะพะด ะฒะฐัั ัะธััะตะผั.

ะะฐัะตะผ ะฒัะฟะพะปะฝะธัะต:

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now gpttg-bot
```

#### ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะฒะธัะพะผ

```bash
sudo systemctl start gpttg-bot     # ะทะฐะฟัััะธัั (ะตัะปะธ ะฝะต ะทะฐะฟััะตะฝ)
sudo systemctl restart gpttg-bot   # ะฟะตัะตะทะฐะฟัััะธัั
sudo systemctl stop gpttg-bot      # ะพััะฐะฝะพะฒะธัั
sudo systemctl status gpttg-bot    # ััะฐััั + ะฟะพัะปะตะดะฝะธะต ัััะพะบะธ ะปะพะณะฐ
sudo journalctl -u gpttg-bot -f    # ยซัะฒะพััยป ะปะพะณะฐ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
sudo systemctl enable gpttg-bot    # ะฒะบะปััะธัั ะฐะฒัะพะทะฐะฟััะบ ะฟัะธ ะทะฐะณััะทะบะต
sudo systemctl disable gpttg-bot   # ัะฑัะฐัั ะฐะฒัะพะทะฐะฟััะบ
```

### ะจะฐะณย5.ยะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต

ะ ะบะพัะฝะต ะฟัะพะตะบัะฐ ะตััั ัะบัะธะฟั **`update_bot.sh`**:

```bash
chmod +x update_bot.sh
sudo ./update_bot.sh
```

ะกะบัะธะฟั:
-ยะดะตะปะฐะตั `git pull`
-ยะพะฑะฝะพะฒะปัะตั ะทะฐะฒะธัะธะผะพััะธ (`poetry install`)
-ยะฟะตัะตะทะฐะฟััะบะฐะตั ัะตัะฒะธั
-ยะฟะพะบะฐะทัะฒะฐะตั ััะฐััั

**ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะฟะพ ะฒัะตะผะตะฝะธ:**
ะะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะพะฒะตััะตั ะฝะฐะปะธัะธะต ะฝะพะฒะพะน ะฒะตััะธะธ ะฝะฐ GitHub ะบะฐะถะดัะน ะดะตะฝั ะฒ 10:00 UTC (13:00 ะะกะ) ั ะฟะพะผะพััั ะฟะปะฐะฝะธัะพะฒัะธะบะฐ aiocron. ะัะปะธ ะดะพัััะฟะฝะฐ ะฝะพะฒะฐั ะฒะตััะธั, ะฐะดะผะธะฝะธัััะฐัะพัั ะฟัะธัะพะดะธั ัะฒะตะดะพะผะปะตะฝะธะต ั ะฟัะตะดะปะพะถะตะฝะธะตะผ ะพะฑะฝะพะฒะธัััั.

---

## 3ยยทยะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั                   | ะะฟะธัะฐะฝะธะต                           | ะัะธะผะตั                     | ะะพยัะผะพะปัะฐะฝะธั |
| ---------------------------- | ---------------------------------- | -------------------------- | ------------ |
| **`BOT_TOKEN`**              | ะขะพะบะตะฝ ะฒะฐัะตะณะพ Telegramโะฑะพัะฐ         | `123456:ABC-DEF...`        | โ            |
| **`OPENAI_API_KEY`**         | APIโะบะปัั OpenAI                    | `sk-...`                   | โ            |
| **`ADMIN_ID`**               | TelegramยID ะฐะดะผะธะฝะธัััะฐัะพัะฐ         | `12345678`                 | โ            |
| `SYSTEM_PROMPT`              | ะกะธััะตะผะฝัะน ะฟัะพะผะฟั ะฐััะธััะตะฝัะฐ        | `ะขัยโ ะฟะพะปะตะทะฝัะน ะฐััะธััะตะฝั.` | ัะพยะถะต        |
| `OPENAI_PRICE_PER_1K_TOKENS` | ะฆะตะฝะฐ ะทะฐย1000ยัะพะบะตะฝะพะฒ (USD)         | `0.002`                    | `0.002`      |
| `WHISPER_PRICE`              | ะฆะตะฝะฐ ัะฐััะธััะพะฒะบะธ 1ยะผะธะฝ ะฐัะดะธะพ (USD) | `0.006`                    | `0.006`      |
| `DALLE_PRICE`                | ะฆะตะฝะฐ ะณะตะฝะตัะฐัะธะธ ะบะฐััะธะฝะบะธ (USD)      | `0.040`                    | `0.040`      |
| `MAX_FILE_MB`                | ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ัะฐะนะปะฐ,ยะะ      | `20`                       | `20`         |
| `DEBUG_MODE`                 | ะะพะดัะพะฑะฝัะน ะปะพะณ (`0/1`)              | `1`                        | `0`          |

> ะะฑัะทะฐัะตะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะพัะผะตัะตะฝั **ะถะธัะฝัะผ**.

---

## 4ยยทยะกัััะบัััะฐ ะฟัะพะตะบัะฐ

<details>
<summary>ะะฐะทะฒะตัะฝััั ะดะตัะตะฒะพ ัะฐะนะปะพะฒ</summary>

```text
GPTTG/
โโโ bot/
โยย โโโ handlers/
โยย โยย โโโ message_handler.py   # ะธะฝะดะธะบะฐัะพั ะฟัะพะณัะตััะฐ
โยย โยย โโโ commands.py          # /start, /help, /img, โฆ
โยย โยย โโโ document.py          # PDFโะดะพะบัะผะตะฝัั
โยย โยย โโโ photo.py             # ะธะทะพะฑัะฐะถะตะฝะธั
โยย โยย โโโ text.py              # ัะตะบััะพะฒัะต ัะพะพะฑัะตะฝะธั
โยย โยย โโโ voice.py             # ะณะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั (Whisper)
โยย โโโ utils/
โยย โยย โโโ openai_client.py     # ะพะฑัััะบะฐ ะดะปั OpenAIยSDK ัยัะฐะนะผะฐััะฐะผะธ
โยย โยย โโโ progress.py          # ะบัะฐัะธะฒัะน ะฟัะพะณัะตััโะฑะฐั
โยย โยย โโโ markdown.py          # ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะฒัะฒะพะดะฐ
โยย โยย โโโ log.py               # ะฝะฐัััะพะนะบะฐ ะปะพะณะพะฒ
โยย โโโ db.py                    # SQLiteโORM
โยย โโโ config.py                # ะฟัะพะฒะตัะบะฐ ะทะฐะฒะธัะธะผะพััะตะน + .env
โยย โโโ keyboards.py             # inline / reply ะบะปะฐะฒะธะฐัััั
โยย โโโ middlewares.py           # ะะโ ะธยerrorโmiddleware
โยย โโโ main.py                  # ัะพัะบะฐ ะฒัะพะดะฐ
โโโ schema.sql                    # ััะตะผะฐ ะะ
โโโ pyproject.toml               # ะทะฐะฒะธัะธะผะพััะธ Poetry
โโโ requirements.txt             # ะทะฐะฒะธัะธะผะพััะธ pip
โโโ .env.example                 # ะฟัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ
โโโ update_bot.sh                # ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธะต ะธยัะตััะฐัั
โโโ README.md                    # ััะพั ัะฐะนะป
```

</details>

---

## 5ยยทยะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

| ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั             | ะัะฒะตั ะฑะพัะฐ                                                             |
| --------------------------------- | ---------------------------------------------------------------------- |
| **PDF**: ยซะกะดะตะปะฐะน ะบัะฐัะบะพะต ัะตะทัะผะตโฆยป | *ะะฝะฐะปะธะท PDF*: ะดะพะบัะผะตะฝั ัะพะดะตัะถะธัโฆ                                       |
| **ะขะตะบัั**: ยซะัะธะฒะตั! ะะฐะบยะดะตะปะฐ?ยป    | ะัะธะฒะตั! ะฃยะผะตะฝั ะฒัั ะพัะปะธัะฝะพ, ัะตะผ ะผะพะณั ะฟะพะผะพัั?                           |
| **ะะพะปะพั**: ยซะะฐััะบะฐะถะธ ะฐะฝะตะบะดะพัยป     | *ะั ัะบะฐะทะฐะปะธ*: โฆ<br>ะะพะฝะตัะฝะพ! ะะพั ะทะฐะฑะฐะฒะฝัะน ะฐะฝะตะบะดะพัโฆ                      |
| `/img` โ ยซะะพั ะฒยะบะพัะผะพัะตยป          | *ะัะฑะตัะธัะต ัะพัะผะฐั*: ะฒะตััะธะบะฐะปัะฝัะน/ะณะพัะธะทะพะฝัะฐะปัะฝัะน โ ะณะตะฝะตัะธััะตััั ะบะฐััะธะฝะบะฐ |

---

## 6ยยทยResponsesยAPIยโ ะพัะพะฑะตะฝะฝะพััะธ

OpenAIยResponsesยAPI ะฟะพะทะฒะพะปัะตั ัะพััะฐะฝััั ะบะพะฝัะตะบัั ะดะธะฐะปะพะณะฐ, ะฟะตัะตะดะฐะฒะฐั ะฒยะทะฐะฟัะพั **ัะพะปัะบะพ** ะฟะพัะปะตะดะฝะตะต ัะพะพะฑัะตะฝะธะต ะธยะธะดะตะฝัะธัะธะบะฐัะพั ะฟัะตะดัะดััะตะณะพ ะพัะฒะตัะฐ:

```python
response = await client.responses.create(
    model="gpt-4o",
    input=[{"type": "message", "content": "ะัะธะฒะตั, ะบะฐะบ ะดะตะปะฐ?", "role": "user"}],
    previous_response_id="resp_abc123",  # ID ะฟัะตะดัะดััะตะณะพ ะพัะฒะตัะฐ
    store=True                            # ัะพััะฐะฝััั ะพัะฒะตั ะดะปั ะฑัะดััะตะณะพ ะบะพะฝัะตะบััะฐ
)
print(response.output[0].content[0].text)
```

ะัะตะธะผััะตััะฒะฐ:

* ัะบะพะฝะพะผะธั ัะพะบะตะฝะพะฒ;
* ะฝะตยะฝัะถะฝะพ ะฒัััะฝัั ัะตะทะฐัั ะดะธะฐะปะพะณ;
* ะผะพะถะฝะพ ยซะฟะพะดัะฒะฐัะธััยป ัะฐะทะณะพะฒะพั ัะฟัััั ะฒัะตะผั.

---

## 7ยยทยะะฐะฑะพัะฐ ัยัะฐะนะปะฐะผะธ

* ะะพะดะดะตัะถะธะฒะฐัััั **ัะพะปัะบะพ PDF** (ะดะปั ะฐะฝะฐะปะธะทะฐ) ะธยะธะทะพะฑัะฐะถะตะฝะธั PNGย/ JPEGย/ WebP.
* ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ัะฟัะฐะฒะปัะตััั `MAX_FILE_MB` (ะฟะพยัะผะพะปัะฐะฝะธั 20ยะะ, ะผะฐะบัะธะผัะผ 100ยะะ).
* ะัะธ ะทะฐะณััะทะบะต PDF ะฑะพั ะดะตะปะฐะตั `purpose="user_data"` ะธยะดะฐะปััะต ะฒั ะผะพะถะตัะต ะทะฐะดะฐะฒะฐัั ะฒะพะฟัะพัั ะบยัะฐะนะปั.

---

## 8ยยทยะะธัะตะฝะทะธั

ะะพะด ัะฐัะฟัะพัััะฐะฝัะตััั ะฟะพะด ะปะธัะตะฝะทะธะตะน **MIT** โ ะฟะพะดัะพะฑะฝะพััะธ ะฒย[LICENSE](LICENSE).

---

*ะะตะฟะพะทะธัะพัะธะน ะพัะบััั ะดะปั pullโrequestโะพะฒ! ะัะดั ัะฐะด ะฒะฐัะธะผ ะธะดะตัะผ ะธยัะปัััะตะฝะธัะผ.*
