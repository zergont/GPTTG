# Telegram‑бот на Responses API

[![GitHub](https://img.shields.io/badge/GitHub-GPTTG-blue?logo=github)](https://github.com/zergont/GPTTG)

Демонстрационный проект, показывающий:
* **OpenAI Responses API** с `previous_response_id` (без хранения всей истории)
* Мультимодальность: текст / фото+подпись / голос+Whisper / генерация изображений
* Учёт токенов и стоимости в SQLite
* Ролевые клавиатуры (пользователь / админ)
* Асинхронность, таймауты, автоматический бэкофф

---

## Быстрый старт

### 1. Клонируйте репозиторий
git clone https://github.com/zergont/GPTTG.git
cd GPTTG

### 2. Создайте виртуальное окружение и установите зависимости

**Через Poetry:**
python -m venv 
.venv source 
.venv/bin/activate  # или .venv\Scripts\activate для Windows 
poetry install

**Или через pip:**
python -m venv 
.venv source 
.venv/bin/activate  # или .venv\Scripts\activate для Windows 
pip install -r requirements.txt

### 3. Настройте переменные окружения

cp .env.example .env
Откройте .env и заполните обязательные ключи

### 4. Запустите бота
python -m bot.main

---
```
## Структура проекта
├── bot/ 
│   ├── handlers/           # Обработчики сообщений 
│   ├── utils/              # Утилиты: OpenAI, БД, логирование 
│   ├── config.py           # Конфигурация и проверка зависимостей 
│   ├── keyboards.py        # Ролевые клавиатуры 
│   ├── middlewares.py      # Middleware для БД и ошибок 
│   └── main.py             # Точка входа приложения 
├── schema.sql              # Схема базы данных SQLite 
├── pyproject.toml          # Poetry (опционально) 
├── requirements.txt        # pip (альтернатива Poetry) 
├── .env.example            # Пример переменных окружения 
└── README.md               # Документация проекта
```
---

## Переменные окружения (.env)

| Переменная                | Описание                        | Пример                | По умолчанию         |
|-------------------------- |---------------------------------|-----------------------|----------------------|
| `BOT_TOKEN`               | Токен Telegram-бота             | `123456:ABC-DEF...`   | **обязательно**      |
| `OPENAI_API_KEY`          | API-ключ OpenAI                 | `sk-...`              | **обязательно**      |
| `ADMIN_ID`                | Telegram ID администратора       | `12345678`            | **обязательно**      |
| `SYSTEM_PROMPT`           | Системный промпт для ассистента | `Ты — полезный ассистент.` | `Ты — полезный ассистент.` |
| `OPENAI_PRICE_PER_1K_TOKENS` | Стоимость 1000 токенов OpenAI (USD) | `0.002`           | `0.002`              |
| `WHISPER_PRICE`           | Стоимость расшифровки аудио Whisper (USD) | `0.006`         | `0.006`              |
| `DALLE_PRICE`             | Стоимость генерации изображения DALL·E (USD) | `0.040`         | `0.040`              |
| `MAX_FILE_MB`             | Максимальный размер файла в МБ   | `20`                  | `20`                 |

---

## Возможности

- **OpenAI Responses API**: поддержка контекста через `previous_response_id`, экономия памяти.
- **Мультимодальность**: текст, фото, голос, генерация изображений.
- **Учёт ресурсов**: подсчёт токенов и стоимости, статистика по пользователям и моделям.
- **Оптимизации**: rate limiting, таймауты, фильтрация обновлений, проверка размера файлов.
- **Интерфейс**: ролевые и inline клавиатуры, статусные сообщения.
- **Безопасность**: права доступа, валидация файлов, логирование ошибок, автоочистка временных файлов.
- **Мониторинг**: логирование, статистика, агрегированные отчёты.

---

## Примеры использования

Пользователь: [отправляет PDF] "Сделай краткое резюме этого документа"  
Бот: 📄 Анализ PDF: Документ содержит...

Пользователь: [отправляет CSV] "Найди аномалии в данных"  
Бот: 📄 Анализ CSV: Обнаружены следующие аномалии...

Пользователь: Привет! Как дела?  
Бот: Привет! У меня всё отлично, спасибо! Чем могу помочь?

Пользователь: [голосовое] "Расскажи анекдот"  
Бот: 🗣 Вы сказали: Расскажи анекдот  
Конечно! Вот забавный анекдот для вас...

Пользователь: /img космический кот в скафандре  
Бот: 🖼 космический кот в скафандре [изображение]

---

## Рекомендации по работе с файлами

- Для загрузки пользовательских файлов используйте `purpose: "user_data"`
- Для изображений используйте `purpose: "vision"`
- Скачивать можно только файлы с `purpose: "assistants_output"`, `"batch_output"`, `"fine-tune-results"`
- Для больших коллекций используйте vector store (до 10 000 файлов)

---

## Лицензия

MIT

---

**Репозиторий:**  
https://github.com/zergont/GPTTG
